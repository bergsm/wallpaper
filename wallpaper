#!/bin/bash

# Active wallpaper lives at $HOME/pics/wallpapers/wallpaper


#check for arg to image
if [ $@ -ne 1 ] || [ grep -q "image data" $1 ]; then
    echo "Wallpaper requries image file as argument"
    exit 1
fi

#Replace active wallpaper with new wallpaper
mv $HOME/pics/wallpapers/wallpaper $HOME/pics/wallpapers/wallpaper_old_$(date '+%b%d%Y_%H%M%S')

cp $1 $HOME/pics/wallpapers/wallpaper

# Copy wallpaper image to firefox (Long term, try symlink to wallpaper)
cp $HOME/pics/wallpapers/wallpaper $HOME/.mozilla/firefox/gxmftrrv.default-release/chrome/wallpaper

# Use pywal to adjust colors for wallpaper
wal -i $HOME/pics/wallpapers/wallpaper >> /dev/null

#Change i3bar colors in .Xresources
sed -i "/wal.color0/c\wal.color0: $color0" $HOME/.Xresources
sed -i "/wal.color1/c\wal.color1: $color1" $HOME/.Xresources
sed -i "/wal.color2/c\wal.color2: $color2" $HOME/.Xresources
sed -i "/wal.color3/c\wal.color3: $color3" $HOME/.Xresources
sed -i "/wal.color4/c\wal.color4: $color4" $HOME/.Xresources
sed -i "/wal.color5/c\wal.color5: $color5" $HOME/.Xresources
sed -i "/wal.color6/c\wal.color6: $color6" $HOME/.Xresources
sed -i "/wal.color7/c\wal.color7: $color7" $HOME/.Xresources
sed -i "/wal.color8/c\wal.color8: $color8" $HOME/.Xresources
sed -i "/wal.color9/c\wal.color9: $color9" $HOME/.Xresources
sed -i "/wal.color10/c\wal.color10: $color10" $HOME/.Xresources
sed -i "/wal.color11/c\wal.color11: $color11" $HOME/.Xresources
sed -i "/wal.color12/c\wal.color12: $color12" $HOME/.Xresources
sed -i "/wal.color13/c\wal.color13: $color13" $HOME/.Xresources
sed -i "/wal.color14/c\wal.color14: $color14" $HOME/.Xresources
sed -i "/wal.color15/c\wal.color15: $color15" $HOME/.Xresources

# Reload i3bar
$pid=$(ps -A | grep i3bar | cut -d ' ' -f 3)
kill $pid
nohup i3bar --bar_id=bar-0 --socket=/run/user/1000/i3/ipc-socket.798 &

# Use feh to set wallpaper?
#feh $HOME/pics/wallpapers/wallpaper.jpeg --bg-fill

#Set multilockscreen wallpapers
multilockscreen -u $HOME/pics/wallpapers/wallpaper >> /dev/null
